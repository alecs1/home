
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){(function(global){var VideoPlayerFactory=require('./lib/VideoPlayerFactory.js'),videoPlayerFactory=new VideoPlayerFactory();module.exports=videoPlayerFactory;global.FTVideo=videoPlayerFactory;global.FTVideo.VERSION='3.4.4';global.BrightcoveFT={Init:{createExperience:function(elementID,optionalCreatedCallback){var isLegacyInit=true;videoPlayerFactory.createPlayerAsync(elementID,optionalCreatedCallback,isLegacyInit);}}};global.onTemplateLoaded=videoPlayerFactory.playerLoadHandler;}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./lib/VideoPlayerFactory.js":8}],2:[function(require,module,exports){module.exports={"brightcoveLibraryUrl":"http://admin.brightcove.com/js/BrightcoveExperiences.js","sectionTagKey":"section:","brandTagKey":"brand:","topicTagKey":"indepth:","videoAdPosition":"video","videoAnalyticsPath":"/video_event","eventGracePeriodMS":1000,"inViewThresholdPercent":50,"bumperDurationSec":6,"trueViewDurationSec":2,"impressionDurationMS":1500,"progressTrackingIntervalSecs":10}},{}],3:[function(require,module,exports){module.exports={"590314128001":1,"605341089001":1,"754609517001":1,"1820439054001":1,"1820439058001":1,"1820439059001":3,"1820439060001":2,"2228337108001":1,"2599156267001":1,"2599156271001":1,"2599156272001":2,"2599156273001":3,"3027992325001":1}},{}],4:[function(require,module,exports){var CONFIG=require('../config/config.json'),videoUtils=require('./videoUtils.js');function AdsDecoratedExperience(videoExperience){videoUtils.extend(videoExperience,AdsDecoratedExperience.prototype);videoExperience.on(videoExperience.MEDIA_CHANGE_EVENT,function(event){videoExperience.conditionallySetAdPolicy(event);});return videoExperience;}
AdsDecoratedExperience.prototype.conditionallySetAdPolicy=function(event){var that=this;this.getAdPolicyAsync(function(existingAdPolicy){if(!existingAdPolicy||!existingAdPolicy.adServerURL){that.setAdPolicy(that._getBrightcoveAdPolicyFor(event.media));}});};AdsDecoratedExperience.prototype._getBrightcoveAdPolicyFor=function(currentMedia){var vidKV={section:videoUtils.getTagValueForMedia(CONFIG.sectionTagKey,currentMedia),brand:videoUtils.getTagValueForMedia(CONFIG.brandTagKey,currentMedia)},zone=videoUtils.getDfpZone(),adURLObj=videoUtils.getAdURLObjFor(zone,CONFIG.videoAdPosition,vidKV);return{adServerURL:adURLObj.urlStem,playerAdKeys:adURLObj.additionalAdTargetingParams};};module.exports=AdsDecoratedExperience;},{"../config/config.json":2,"./videoUtils.js":10}],5:[function(require,module,exports){var CONFIG=require('../config/config.json'),videoDisplayedCountByPlayerID=require('../config/videoDisplayedCountByPlayerID.json'),videoUtils=require('./videoUtils.js'),bind=videoUtils.bind;function AnalyticsDecoratedExperience(videoExperience,config){videoUtils.extend(videoExperience,AnalyticsDecoratedExperience.prototype);videoExperience._initAnalytics(config);return videoExperience;}
AnalyticsDecoratedExperience.prototype.trackEvent=function(eventName,optionalParamsArray,optionalEventTime){var queryParamsArray=optionalParamsArray||[],timeSinceLoadMS=(optionalEventTime||this._getTimeSincePageLoad());queryParamsArray.unshift('timeMS='+timeSinceLoadMS);queryParamsArray.unshift('instanceID='+this._getInstanceID());queryParamsArray.unshift('type='+eventName);videoUtils.trackEvent(CONFIG.videoAnalyticsPath,queryParamsArray);};AnalyticsDecoratedExperience.prototype._initAnalytics=function(config){this.wasLoadRequested=config.wasLoadRequested;this.autoplayRequested=config.autoplayRequested||false;this.pageLoadTimestamp=config.pageLoadTimestamp;this._attachAnalyticsHandlers();};AnalyticsDecoratedExperience.prototype._attachAnalyticsHandlers=function(){this.on(this.TEMPLATE_READY_EVENT,bind(this._trackPlayerLoad,this));this._initImpressionTracking();this._initStreamTracking();this.on(this.AD_START_EVENT,bind(this._trackAdStart,this));this.on(this.AD_COMPLETE_EVENT,bind(this._trackAdComplete,this));this.on(this.MEDIA_BEGIN_EVENT,bind(this._trackVideoStart,this));this._initTrueViewTracking();this._initPlaybackTracking();};AnalyticsDecoratedExperience.prototype._trackPlayerLoad=function(){this.trackEvent('player_load',this._getLoadMetadataParams());};AnalyticsDecoratedExperience.prototype._trackAdStart=function(){this._trackStreamEvent('ad_start');};AnalyticsDecoratedExperience.prototype._trackAdComplete=function(){this._trackStreamEvent('ad_complete');};AnalyticsDecoratedExperience.prototype._trackVideoStart=function(event){this._trackStreamEvent('video_start',['renditionBitrate='+this._getBitrateForMedia(event.media)]);};AnalyticsDecoratedExperience.prototype._initImpressionTracking=function(){var trackFirstImpressionAsync=function(){var impressionTimeMS=this._getTimeSincePageLoad();this.getCurrentVideoAsync(bind(function(currentVideo){var videoID=this._getVideoIDForMedia(currentVideo),playlistID=this._getPlaylistIDForMedia(currentVideo);this.getPlaylistWithIDAsync(playlistID,bind(function(playlist){this.getBrightcovePlayerIDAsync(bind(function(playerID){trackFirstImpression.call(this,videoID,playlist,playerID,impressionTimeMS);},this));},this));},this));},trackFirstImpression=function(videoID,playlist,playerID,impressionTimeMS){var videos=playlist&&playlist.videos,videoCountDisplayedInPlayer=videoDisplayedCountByPlayerID[playerID]||1,index,video,currentVideoID,locationIndex;if(videos){for(index=0;index<videoCountDisplayedInPlayer&&videos[index];index+=1){video=videos[index];currentVideoID=this._getVideoIDForMedia(video);locationIndex=index+1;trackVideoImpression.call(this,currentVideoID,locationIndex,impressionTimeMS);}}else{trackVideoImpression.call(this,videoID,1,impressionTimeMS);}},trackVideoImpression=function(videoID,locationIndex,impressionTimeMS){var trackingParams=['locationIndex='+locationIndex,'videoID='+videoID];this.trackEvent('first_impression',trackingParams,impressionTimeMS);},checkImpressionIntervalID=0,impressionCompleteTimeoutID=0,attachImpressionTracking=function(){checkImpressionIntervalID=setInterval(bind(checkForImpression,this),1000);checkForImpression.call(this);},checkForImpression=function(){if(this._getIsPlayerInView()&&!impressionCompleteTimeoutID){impressionCompleteTimeoutID=setTimeout(bind(conditionallyTrackImpression,this),CONFIG.impressionDurationMS);}},stopCheckingForImpression=function(){clearInterval(checkImpressionIntervalID);checkImpressionIntervalID=0;},conditionallyTrackImpression=function(){if(this._getIsPlayerInView()){stopCheckingForImpression();trackFirstImpressionAsync.call(this);}
resetImpressionCompleteCheck();},resetImpressionCompleteCheck=function(){clearTimeout(impressionCompleteTimeoutID);impressionCompleteTimeoutID=0;};this.on(this.TEMPLATE_READY_EVENT,bind(attachImpressionTracking,this));};AnalyticsDecoratedExperience.prototype._initStreamTracking=function(){var streamTrackedForMedia=false,resetStreamTracked=function(){streamTrackedForMedia=false;},conditionallyTrackStream=function(event){if(!streamTrackedForMedia){this.currentStreamIndex+=1;streamTrackedForMedia=true;trackStreamAsync.call(this,event);}},trackStreamAsync=function(event){var streamTimeMS=this._getTimeSincePageLoad();this.getCurrentVideoAsync(bind(function(currentVideo){var videoID=this._getVideoIDForMedia(currentVideo),playlistID=this._getPlaylistIDForMedia(currentVideo);this._getVideoIndexInPlaylistAsync(videoID,playlistID,bind(function(videoIndex){trackStream.call(this,event,videoID,videoIndex,streamTimeMS);},this));},this));},trackStream=function(event,videoID,videoIndex,streamTimeMS){var locIndex=(typeof videoIndex==='number'?videoIndex+1:1),isFromAdStart=this._getIsEventOfGivenType(event,this.AD_START_EVENT),trackingParams;trackingParams=['locationIndex='+locIndex,'videoID='+videoID,'isFromAdNotVideo='+isFromAdStart];this._trackStreamEvent('stream',trackingParams,streamTimeMS);};this.currentStreamIndex=0;this.on(this.AD_START_EVENT,bind(conditionallyTrackStream,this));this.on(this.MEDIA_BEGIN_EVENT,bind(conditionallyTrackStream,this));this.on(this.MEDIA_CHANGE_EVENT,bind(resetStreamTracked,this));};AnalyticsDecoratedExperience.prototype._initTrueViewTracking=function(){var previousPreviousViewedSecond=null,previousViewedSecond=null,latestViewedSecond=null,trueViewTracked=false,resetTrueViewTracking=function(){previousPreviousViewedSecond=null;previousViewedSecond=null;latestViewedSecond=null;trueViewTracked=false;},conditionallySavePosition=function(event){var posDesc=this._getPositionDescriptorForEvent(event),currentPositionSeconds=posDesc.seconds;if(!trueViewTracked&&currentPositionSeconds>CONFIG.bumperDurationSec&&latestViewedSecond!==currentPositionSeconds&&this._getIsPlayerInView()){previousPreviousViewedSecond=previousViewedSecond;previousViewedSecond=latestViewedSecond;latestViewedSecond=currentPositionSeconds;}},conditionallyTrackTrueView=function(event){var trueViewDuration=CONFIG.trueViewDurationSec,trueViewDurationElapsed=false;if(trueViewTracked){return;}else if(typeof latestViewedSecond==='number'&&typeof previousViewedSecond==='number'&&(latestViewedSecond-previousViewedSecond)===trueViewDuration){trueViewDurationElapsed=true;}else if(typeof latestViewedSecond==='number'&&typeof previousPreviousViewedSecond==='number'&&(latestViewedSecond-previousPreviousViewedSecond)===trueViewDuration){trueViewDurationElapsed=true;}
if(trueViewDurationElapsed){trackTrueView.call(this,event);trueViewTracked=true;}},trackTrueView=function(event){var posDesc=this._getPositionDescriptorForEvent(event);this._trackStreamEvent('true_view',['playPos='+posDesc.seconds,'playPerc='+posDesc.percent]);};this.on(this.MEDIA_PROGRESS_EVENT,bind(conditionallySavePosition,this));this.on(this.MEDIA_PROGRESS_EVENT,bind(conditionallyTrackTrueView,this));this.on(this.MEDIA_BEGIN_EVENT,bind(resetTrueViewTracking,this));this.on(this.MEDIA_CHANGE_EVENT,bind(resetTrueViewTracking,this));};AnalyticsDecoratedExperience.prototype._initPlaybackTracking=function(){var uniquePlayedSecondsStatuses=[],lastPlaybackTrackedPosition=0,videoCompleteTracked=false,resetPlaybackTracking=function(){uniquePlayedSecondsStatuses=[];lastPlaybackTrackedPosition=0;videoCompleteTracked=false;},conditionallySaveUniqueProgress=function(event){var posDesc=this._getPositionDescriptorForEvent(event),currentSecond=posDesc.seconds;if(currentSecond>0&&typeof uniquePlayedSecondsStatuses[currentSecond]==='undefined'){uniquePlayedSecondsStatuses[currentSecond]=this._getIsPlayerInView();}},conditionallyTrackPlayback=function(event){var posDesc=this._getPositionDescriptorForEvent(event),currentPositionSeconds=posDesc.seconds;if(currentPositionSeconds>0&&currentPositionSeconds%CONFIG.progressTrackingIntervalSecs===0&&currentPositionSeconds!==lastPlaybackTrackedPosition){lastPlaybackTrackedPosition=currentPositionSeconds;trackPlayback.call(this,event);}},getUniqPlayedSeconds=function(){return videoUtils.getElementCountForArray(uniquePlayedSecondsStatuses);},getUniqPlayedSecondsInView=function(){var secondsInViewStatuses=videoUtils.filter(uniquePlayedSecondsStatuses,function(wasSecondInView){return wasSecondInView;});return videoUtils.getElementCountForArray(secondsInViewStatuses);},getUniqPlayedSecondsOutView=function(){var secondsOutViewStatuses=videoUtils.filter(uniquePlayedSecondsStatuses,function(wasSecondInView){return!wasSecondInView;});return videoUtils.getElementCountForArray(secondsOutViewStatuses);},getPlaybackTrackingParams=function(event){var durationFloat=event.duration||1.0,playedUniqSec=getUniqPlayedSeconds(),playedUniqSecInView=getUniqPlayedSecondsInView(),playedUniqSecOutView=getUniqPlayedSecondsOutView(),playedUniqPerc=Math.round(100*playedUniqSec/durationFloat),playedUniqPercInView=Math.round(100*playedUniqSecInView/durationFloat),playedUniqPercOutView=Math.round(100*playedUniqSecOutView/durationFloat),trackingParams;trackingParams=['playedUniqSec='+playedUniqSec,'playedUniqSecInView='+playedUniqSecInView,'playedUniqSecOutView='+playedUniqSecOutView,'playedUniqPerc='+playedUniqPerc,'playedUniqPercInView='+playedUniqPercInView,'playedUniqPercOutView='+playedUniqPercOutView];return trackingParams;},trackPlayback=function(event){var trackingParams=getPlaybackTrackingParams(event);this._trackStreamEvent('playback',trackingParams);},conditionallyTrackVideoComplete=function(event){var trackingParams=getPlaybackTrackingParams(event);if(!videoCompleteTracked){this._trackStreamEvent('video_complete',trackingParams);videoCompleteTracked=true;}};this.on(this.MEDIA_PROGRESS_EVENT,bind(conditionallySaveUniqueProgress,this));this.on(this.MEDIA_PROGRESS_EVENT,bind(conditionallyTrackPlayback,this));this.on(this.MEDIA_COMPLETE_EVENT,bind(conditionallyTrackVideoComplete,this));this.on(this.MEDIA_BEGIN_EVENT,bind(resetPlaybackTracking,this));this.on(this.MEDIA_CHANGE_EVENT,bind(resetPlaybackTracking,this));};AnalyticsDecoratedExperience.prototype._trackStreamEvent=function(eventName,optionalParamsArray,optionalEventTime){var queryParamsArray=optionalParamsArray||[];queryParamsArray.unshift('streamIndex='+this.currentStreamIndex);queryParamsArray.unshift('isInView='+this._getIsPlayerInView());this.trackEvent(eventName,queryParamsArray,optionalEventTime);};AnalyticsDecoratedExperience.prototype._getMetadataStringAsync=function(callback){this.getCurrentVideoAsync(bind(function(currentVideo){this.getBrightcovePlayerIDAsync(bind(function(playerID){callback(this._getMetadataStringForVideoAndPlayer(currentVideo,playerID));},this));},this));};AnalyticsDecoratedExperience.prototype._getMetadataStringForVideoAndPlayer=function(currentVideo,playerID){var videoMetadataArray=[playerID||'','',currentVideo.playlistID||'',currentVideo.id||'',videoUtils.escapeWhitespace(currentVideo.displayName),videoUtils.escapeWhitespace(videoUtils.getTagValueForMedia(CONFIG.sectionTagKey,currentVideo)),videoUtils.escapeWhitespace(videoUtils.getTagValueForMedia(CONFIG.brandTagKey,currentVideo)),videoUtils.escapeWhitespace(videoUtils.getTagValueForMedia(CONFIG.topicTagKey,currentVideo))];return videoMetadataArray.join('/');};AnalyticsDecoratedExperience.prototype._getLoadMetadataParams=function(){var playerSelector='#'+this.elementID,position=videoUtils.getElementPositionFromCenter(playerSelector),loadMetadataParams=['isInView='+this._getIsPlayerInView(),'wasLoadRequested='+this.wasLoadRequested,'willAutoplay='+this._getWillAutoplay(),'playerPlatform='+this.getPlayerPlatform(),'loadedTop='+((position&&typeof position.top==='number')?position.top:null),'loadedLeft='+((position&&typeof position.left==='number')?position.left:null)];return loadMetadataParams;};AnalyticsDecoratedExperience.prototype._getTimeSincePageLoad=function(){return(this.pageLoadTimestamp?(new Date().valueOf()-this.pageLoadTimestamp):null);};AnalyticsDecoratedExperience.prototype._getWillAutoplay=function(){var videoPlayerModule=this._getLibraryModuleForModuleName('VIDEO_PLAYER'),canPlayWithoutInteraction=videoPlayerModule.canPlayWithoutInteraction();return(this.autoplayRequested&&canPlayWithoutInteraction?true:false);};AnalyticsDecoratedExperience.prototype._getIsPlayerInView=function(){var isPlayerVisible=videoUtils.getElementPercentageInView('#'+this.elementID)>=CONFIG.inViewThresholdPercent,isPageFocused=videoUtils.getIsPageFocused();return(isPlayerVisible&&isPageFocused);};AnalyticsDecoratedExperience.prototype._getInstanceID=function(){return this.elementID||null;};AnalyticsDecoratedExperience.prototype._getIsEventOfGivenType=function(event,eventDescriptor){var isEventOfGivenType=false;if(eventDescriptor.isBrightcoveEvent&&event.type===this._getLibraryEventTypeForDescriptor(eventDescriptor)){isEventOfGivenType=true;}
return isEventOfGivenType;};AnalyticsDecoratedExperience.prototype._getPositionDescriptorForEvent=function(event){var posSecs=Math.floor(event.position),posPercent=Math.floor((event.position/event.duration)*100);return{seconds:posSecs,percent:posPercent};};AnalyticsDecoratedExperience.prototype._getBitrateForMedia=function(media){var bitrate=null,currentRenditionURL,matchingRenditions;if(media&&media.encodingRate){bitrate=media.encodingRate||null;}else if(media&&media.defaultURL&&media.renditions){currentRenditionURL=media.defaultURL;matchingRenditions=videoUtils.filter(media.renditions,function(rendition){return(rendition.defaultURL===currentRenditionURL);});if(matchingRenditions.length>0){bitrate=matchingRenditions[0].encodingRate||null;}}
return bitrate;};AnalyticsDecoratedExperience.prototype._getVideoIDForMedia=function(media){return(media&&media.id)||null;};AnalyticsDecoratedExperience.prototype._getPlaylistIDForMedia=function(media){var playlistID=null;if(media){playlistID=media.playlistID||media.lineupId||null;}
return playlistID;};AnalyticsDecoratedExperience.prototype._getVideoIndexInPlaylistAsync=function(videoID,playlistID,callback){this.getPlaylistWithIDAsync(playlistID,function(playlist){var foundIndex=null,videos=playlist&&playlist.videos,index;for(index=0;videos&&index<videos.length;index+=1){if(videos[index].id===videoID){foundIndex=index;break;}}
callback(foundIndex);});};module.exports=AnalyticsDecoratedExperience;},{"../config/config.json":2,"../config/videoDisplayedCountByPlayerID.json":3,"./videoUtils.js":10}],6:[function(require,module,exports){var VideoExperience=require('./VideoExperience.js'),AdsDecoratedExperience=require('./AdsDecoratedExperience.js'),AnalyticsDecoratedExperience=require('./AnalyticsDecoratedExperience.js');function FTVideoPlayer(brightcoveLibrary,brightcoveExperience,config){var videoExperience=new VideoExperience(brightcoveLibrary,brightcoveExperience),adsDecoratedExperience=new AdsDecoratedExperience(videoExperience);if(videoExperience.getPlayerPlatform().toLowerCase()==='flash'){return new AnalyticsDecoratedExperience(adsDecoratedExperience,config);}else{return adsDecoratedExperience;}}
module.exports=FTVideoPlayer;},{"./AdsDecoratedExperience.js":4,"./AnalyticsDecoratedExperience.js":5,"./VideoExperience.js":7}],7:[function(require,module,exports){var CONFIG=require('../config/config.json'),videoUtils=require('./videoUtils.js'),bind=videoUtils.bind;function VideoExperience(brightcoveLibrary,brightcoveExperience){this.BC_LIBRARY_EVENTS=brightcoveLibrary.api.events;this.BC_LIBRARY_MODULE_NAMES=brightcoveLibrary.api.modules.APIModules;this.brightcoveExperience=brightcoveExperience;this.elementID=brightcoveExperience.id;this.facadeEventHandlersByEventName={};this.cachedPlaylistsByID={};this._initFacadeEvents();}
VideoExperience.prototype.on=function(eventDescriptor,handler){var brightcoveModule,brightcoveEventType;if(eventDescriptor.isBrightcoveEvent){brightcoveModule=this._getLibraryModuleForEvent(eventDescriptor);brightcoveEventType=this._getLibraryEventTypeForDescriptor(eventDescriptor);brightcoveModule.addEventListener(brightcoveEventType,handler);}else if(eventDescriptor.isFacadeEvent){this._addFacadeEventListener(eventDescriptor,handler);}};VideoExperience.prototype.getAdPolicyAsync=function(callback){var adsModule=this._getLibraryModuleForModuleName('ADVERTISING');adsModule.getAdPolicy(callback);};VideoExperience.prototype.setAdPolicy=function(adPolicy,optionalCallback){var adsModule=this._getLibraryModuleForModuleName('ADVERTISING');adsModule.setAdPolicy(adPolicy,optionalCallback);};VideoExperience.prototype.getCurrentVideoAsync=function(callback){var videoPlayerModule=this._getLibraryModuleForModuleName('VIDEO_PLAYER');videoPlayerModule.getCurrentVideo(callback);};VideoExperience.prototype.getCurrentVideoIDAsync=function(callback){this.getCurrentVideoAsync(function(currentVideo){callback(currentVideo.id);});};VideoExperience.prototype.getPlaylistWithIDAsync=function(playlistID,callback){var contentModule=this._getLibraryModuleForModuleName('CONTENT'),cachedPlaylist=this.cachedPlaylistsByID[playlistID];if(!playlistID){callback(null);}else if(cachedPlaylist){callback(cachedPlaylist);}else{contentModule.getPlaylistByID(playlistID,bind(function(playlist){this.cachedPlaylistsByID[playlistID]=playlist;callback(playlist);},this));}};VideoExperience.prototype.getBrightcovePlayerIDAsync=function(callback){var experienceModule=this._getLibraryModuleForModuleName('EXPERIENCE');experienceModule.getExperienceID(callback);};VideoExperience.prototype.getPlayerPlatform=function(){return this.brightcoveExperience.type||null;};VideoExperience.prototype._getLibraryModuleForEvent=function(eventDescriptor){var bcModuleName=eventDescriptor.bcModuleName;return this._getLibraryModuleForModuleName(bcModuleName);};VideoExperience.prototype._getLibraryModuleForModuleName=function(bcModuleName){var bcInternalModuleName=this.BC_LIBRARY_MODULE_NAMES[bcModuleName];return this.brightcoveExperience.getModule(bcInternalModuleName);};VideoExperience.prototype._getLibraryEventTypeForDescriptor=function(eventDescriptor){var bcEventName=eventDescriptor.bcEventName,bcEventType=eventDescriptor.bcEventType;return this.BC_LIBRARY_EVENTS[bcEventType][bcEventName];};VideoExperience.prototype._addFacadeEventListener=function(eventDescriptor,handler){var eventName=eventDescriptor.eventName;this.facadeEventHandlersByEventName[eventName]=this.facadeEventHandlersByEventName[eventName]||[];this.facadeEventHandlersByEventName[eventName].push(handler);};VideoExperience.prototype._initFacadeEvents=function(){var thisExperience=this,facadeEventDescriptors;facadeEventDescriptors=videoUtils.filter(VideoExperience.prototype,function(property){return property.isFacadeEvent;});videoUtils.each(facadeEventDescriptors,function(eventDescriptor){eventDescriptor.init(thisExperience,function(event){thisExperience._dispatchFacadeEventHandlers(eventDescriptor.eventName,event);});});};VideoExperience.prototype._dispatchFacadeEventHandlers=function(eventName,event){var eventHandlers=this.facadeEventHandlersByEventName[eventName]||[],eventHandler,index;for(index=0;index<eventHandlers.length;index+=1){eventHandler=eventHandlers[index];try{eventHandler.call(this,event);}catch(err){console.log('ERROR IN VIDEO EVENT HANDLER. Event: '+eventName+'. '+err.name+': '+err.message);}}};VideoExperience.prototype.AD_COMPLETE_EVENT={isFacadeEvent:true,eventName:'AD_COMPLETE_EVENT',init:function(videoExperience,triggerEventCallback){var wasMediaRecentlyChanged=false,mediaRecentlyChangedTimeout=0,pulseMediaRecentlyChanged=function(){clearTimeout(mediaRecentlyChangedTimeout);wasMediaRecentlyChanged=true;mediaRecentlyChangedTimeout=setTimeout(resetMediaRecentlyChanged,CONFIG.eventGracePeriodMS);},resetMediaRecentlyChanged=function(){wasMediaRecentlyChanged=false;},conditionallyTriggerAdComplete=function(event){if(!wasMediaRecentlyChanged){triggerEventCallback(event);}};videoExperience.on(videoExperience.MEDIA_CHANGE_EVENT,pulseMediaRecentlyChanged);videoExperience.on(videoExperience.DEPRECATED_AD_COMPLETE_EVENT,conditionallyTriggerAdComplete);}};VideoExperience.prototype.MEDIA_PAUSE_EVENT={isFacadeEvent:true,eventName:'MEDIA_PAUSE_EVENT',init:function(videoExperience,triggerEventCallback){var scrubTimeoutID=0,callAfterDebouncingScrub=function(callback){cancelDebouncedScrub();scrubTimeoutID=setTimeout(function(){cancelDebouncedScrub();callback();},CONFIG.eventGracePeriodMS);},cancelDebouncedScrub=function(){clearTimeout(scrubTimeoutID);scrubTimeoutID=0;},conditionallyTriggerPause=function(event){callAfterDebouncingScrub(function(){var posPercentage=Math.round((event.position/event.duration)*100);if(posPercentage<100){triggerEventCallback(event);}});};videoExperience.on(videoExperience.MEDIA_PLAY_EVENT,cancelDebouncedScrub);videoExperience.on(videoExperience.MEDIA_STOP_EVENT,conditionallyTriggerPause);}};VideoExperience.prototype.MEDIA_UNPAUSE_EVENT={isFacadeEvent:true,eventName:'MEDIA_UNPAUSE_EVENT',init:function(videoExperience,triggerEventCallback){var wasVideoStarted=false,stopFiredRecently=false,setVideoStarted=function(){wasVideoStarted=true;},resetVideoStarted=function(){wasVideoStarted=false;},pulseStopFiredRecently=function(){stopFiredRecently=true;setTimeout(function(){stopFiredRecently=false;},CONFIG.eventGracePeriodMS);},conditionallyTriggerUnpause=function(event){if(wasVideoStarted&&!stopFiredRecently){triggerEventCallback(event);}};videoExperience.on(videoExperience.MEDIA_BEGIN_EVENT,setVideoStarted);videoExperience.on(videoExperience.MEDIA_CHANGE_EVENT,resetVideoStarted);videoExperience.on(videoExperience.MEDIA_COMPLETE_EVENT,resetVideoStarted);videoExperience.on(videoExperience.MEDIA_STOP_EVENT,pulseStopFiredRecently);videoExperience.on(videoExperience.MEDIA_PLAY_EVENT,conditionallyTriggerUnpause);}};VideoExperience.prototype.AD_START_EVENT={isBrightcoveEvent:true,bcEventName:'START',bcEventType:'AdEvent',bcModuleName:'ADVERTISING'};VideoExperience.prototype.DEPRECATED_AD_COMPLETE_EVENT={isBrightcoveEvent:true,bcEventName:'COMPLETE',bcEventType:'AdEvent',bcModuleName:'ADVERTISING'};VideoExperience.prototype.AUTH_NEEDED_EVENT={isBrightcoveEvent:true,bcEventName:'AUTH_NEEDED',bcEventType:'AuthEvent',bcModuleName:'AUTH'};VideoExperience.prototype.CAPTIONS_LOAD_ERROR_EVENT={isBrightcoveEvent:true,bcEventName:'DFXP_LOAD_ERROR',bcEventType:'CaptionsEvent',bcModuleName:'CAPTIONS'};VideoExperience.prototype.CAPTIONS_LOAD_SUCCESS_EVENT={isBrightcoveEvent:true,bcEventName:'DFXP_LOAD_SUCCESS',bcEventType:'CaptionsEvent',bcModuleName:'CAPTIONS'};VideoExperience.prototype.MEDIA_NOT_FOUND_EVENT={isBrightcoveEvent:true,bcEventName:'MEDIA_NOT_FOUND',bcEventType:'ContentEvent',bcModuleName:'CONTENT'};VideoExperience.prototype.CUE_POINT_EVENT={isBrightcoveEvent:true,bcEventName:'CUE',bcEventType:'CuePointEvent',bcModuleName:'CUE_POINTS'};VideoExperience.prototype.TEMPLATE_READY_EVENT={isBrightcoveEvent:true,bcEventName:'TEMPLATE_READY',bcEventType:'ExperienceEvent',bcModuleName:'EXPERIENCE'};VideoExperience.prototype.MEDIA_BEGIN_EVENT={isBrightcoveEvent:true,bcEventName:'BEGIN',bcEventType:'MediaEvent',bcModuleName:'VIDEO_PLAYER'};VideoExperience.prototype.MEDIA_CHANGE_EVENT={isBrightcoveEvent:true,bcEventName:'CHANGE',bcEventType:'MediaEvent',bcModuleName:'VIDEO_PLAYER'};VideoExperience.prototype.MEDIA_COMPLETE_EVENT={isBrightcoveEvent:true,bcEventName:'COMPLETE',bcEventType:'MediaEvent',bcModuleName:'VIDEO_PLAYER'};VideoExperience.prototype.MEDIA_ERROR_EVENT={isBrightcoveEvent:true,bcEventName:'ERROR',bcEventType:'MediaEvent',bcModuleName:'VIDEO_PLAYER'};VideoExperience.prototype.MEDIA_PLAY_EVENT={isBrightcoveEvent:true,bcEventName:'PLAY',bcEventType:'MediaEvent',bcModuleName:'VIDEO_PLAYER'};VideoExperience.prototype.MEDIA_PROGRESS_EVENT={isBrightcoveEvent:true,bcEventName:'PROGRESS',bcEventType:'MediaEvent',bcModuleName:'VIDEO_PLAYER'};VideoExperience.prototype.MEDIA_SEEK_EVENT={isBrightcoveEvent:true,bcEventName:'SEEK_NOTIFY',bcEventType:'MediaEvent',bcModuleName:'VIDEO_PLAYER'};VideoExperience.prototype.MEDIA_STOP_EVENT={isBrightcoveEvent:true,bcEventName:'STOP',bcEventType:'MediaEvent',bcModuleName:'VIDEO_PLAYER'};module.exports=VideoExperience;},{"../config/config.json":2,"./videoUtils.js":10}],8:[function(require,module,exports){(function(global){var CONFIG=require('../config/config.json'),videoUtils=require('./videoUtils.js'),bind=videoUtils.bind,FTVideoPlayer=require('./FTVideoPlayer.js'),pageLoadTimestamp=new Date().valueOf();function VideoPlayerFactory(){this.createdCallbacksByElementID={};this.videoPlayersByElementID={};this.pendingPlayerConfigByID={};this.pendingLibraryCallbacks=[];this.brightcoveLibraryRequested=false;this.playerLoadHandler=bind(this._playerLoadHandler,this);}
VideoPlayerFactory.prototype.createPlayerAsync=function(elementID,optionalCreatedCallback,optionalIsLegacyInit){var isLegacyInit=(optionalIsLegacyInit?true:false);if(typeof optionalCreatedCallback==='function'){this._enqueueCreatedCallback(elementID,optionalCreatedCallback);}
if(this._getExistingPlayer(elementID)){this._dispatchCreatedCallbacks(elementID,this._getExistingPlayer(elementID));}else if(!this._isPlayerLoadPending(elementID)){this._triggerPlayerLoad(elementID,isLegacyInit);}};VideoPlayerFactory.prototype._playerLoadHandler=function(elementID){var brightcoveExperience,playerConfig,ftVideoPlayer;brightcoveExperience=global.brightcove.api.getExperience(elementID);playerConfig=this._getConfigForPlayer(elementID);ftVideoPlayer=new FTVideoPlayer(global.brightcove,brightcoveExperience,playerConfig);this._saveExistingVideoPlayer(elementID,ftVideoPlayer);this.pendingPlayerConfigByID[elementID]=null;this._dispatchCreatedCallbacks(elementID,ftVideoPlayer);};VideoPlayerFactory.prototype._triggerPlayerLoad=function(elementID,isLegacyInit){this._saveConfigForPendingPlayer(elementID);this._trackPlayerLoadRequested(elementID,isLegacyInit);this._invokeAfterLibraryPresent(bind(function(){global.brightcove.createExperiences(null,elementID);},this));};VideoPlayerFactory.prototype._isPlayerLoadPending=function(elementID){return(this.pendingPlayerConfigByID[elementID]?true:false);};VideoPlayerFactory.prototype._getExistingPlayer=function(elementID){return this.videoPlayersByElementID[elementID];};VideoPlayerFactory.prototype._saveExistingVideoPlayer=function(elementID,ftVideoPlayer){this.videoPlayersByElementID[elementID]=ftVideoPlayer;};VideoPlayerFactory.prototype._enqueueCreatedCallback=function(elementID,callback){this.createdCallbacksByElementID[elementID]=this.createdCallbacksByElementID[elementID]||[];this.createdCallbacksByElementID[elementID].push(callback);};VideoPlayerFactory.prototype._dispatchCreatedCallbacks=function(elementID,ftVideoPlayer){var createdCallbacks=this.createdCallbacksByElementID[elementID]||[],callback;while(createdCallbacks.length>0){callback=createdCallbacks.shift();try{callback(ftVideoPlayer);}catch(error){console.log('FT VIDEO - Error thrown in end-user player load callback: '+error);}}};VideoPlayerFactory.prototype._invokeAfterLibraryPresent=function(callback){this.pendingLibraryCallbacks.push(callback);if(global.brightcove){this._dispatchLibraryCallbacks();}else if(!this.brightcoveLibraryRequested){this.brightcoveLibraryRequested=true;videoUtils.loadScriptAsync(CONFIG.brightcoveLibraryUrl,bind(function(){this._dispatchLibraryCallbacks();},this));}};VideoPlayerFactory.prototype._dispatchLibraryCallbacks=function(){var callback;while(this.pendingLibraryCallbacks.length>0){callback=this.pendingLibraryCallbacks.shift();callback();}};VideoPlayerFactory.prototype._saveConfigForPendingPlayer=function(elementID){var $player=videoUtils.getJQueryElement('#'+elementID),autoplayParamString=videoUtils.trim(videoUtils.getParamValForJQueryElement($player,'autoStart')),playerConfig={wasLoadRequested:true,autoplayRequested:(autoplayParamString.toLowerCase()==='true'),pageLoadTimestamp:pageLoadTimestamp};this.pendingPlayerConfigByID[elementID]=playerConfig;};VideoPlayerFactory.prototype._getConfigForPlayer=function(elementID){var UNREQUESTED_PLAYER_CONFIG={wasLoadRequested:false,pageLoadTimestamp:pageLoadTimestamp},playerConfig=this.pendingPlayerConfigByID[elementID]||UNREQUESTED_PLAYER_CONFIG;return playerConfig;};VideoPlayerFactory.prototype._trackPlayerLoadRequested=function(elementID,isLegacyInit){var playerSelector='#'+elementID,$player=videoUtils.getJQueryElement(playerSelector),trim=bind(videoUtils.trim,videoUtils),escape=bind(videoUtils.escapeWhitespace,videoUtils),playerID=null,videoID=null,rawPlaylistString,playlistRef=null,playlistID=null,isInView=null,autoplayReqd=null,width=null,height=null,requestedPosition,trackingParams;if($player){playerID=trim(videoUtils.getParamValForJQueryElement($player,'playerID'))||null;videoID=trim(videoUtils.getParamValForJQueryElement($player,'@videoPlayer'))||null;rawPlaylistString=trim(videoUtils.getParamValForJQueryElement($player,'@videoList'))||'';playlistRef=escape(trim(videoUtils.getStringAfterPrefix(rawPlaylistString,'ref:')))||null;if(rawPlaylistString&&!playlistRef){playlistID=escape(trim(rawPlaylistString))||null;}
autoplayReqd=(trim(videoUtils.getParamValForJQueryElement($player,'autoStart')).toLowerCase()==='true');width=videoUtils.stripNonNumeric(videoUtils.getParamValForJQueryElement($player,'width'))||null;height=videoUtils.stripNonNumeric(videoUtils.getParamValForJQueryElement($player,'height'))||null;}
isInView=(videoUtils.getElementPercentageInView(playerSelector)>=CONFIG.inViewThresholdPercent&&videoUtils.getIsPageFocused());requestedPosition=videoUtils.getElementPositionFromCenter(playerSelector);trackingParams=['type=player_load_requested','instanceID='+elementID,'timeMS='+(new Date().valueOf()-pageLoadTimestamp),'playerID='+playerID,'videoID='+videoID,'playlistRef='+playlistRef,'playlistID='+playlistID,'isLegacyInit='+isLegacyInit,'isInView='+isInView,'autoplayRequested='+autoplayReqd,'hasAdblock='+videoUtils.getIsAdblockPresent(),'requestedTop='+(requestedPosition&&requestedPosition.top)||null,'requestedLeft='+(requestedPosition&&requestedPosition.left)||null,'width='+width,'height='+height];videoUtils.trackEvent('/video_event',trackingParams);};module.exports=VideoPlayerFactory;}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../config/config.json":2,"./FTVideoPlayer.js":6,"./videoUtils.js":10}],9:[function(require,module,exports){(function(global){module.exports=global.FT;}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],10:[function(require,module,exports){var globalFT=require('./globalFT.js');function VideoUtils(ft){this.FT=ft;}
VideoUtils.prototype.loadScriptAsync=function(url,callback){this.FT.$.ajax({url:url,dataType:'script',success:callback,cache:true});};VideoUtils.prototype.getJQueryElement=function(selector){var matchedElements=this.FT.$(selector);return(matchedElements.length>0?this.FT.$(matchedElements[0]):null);};VideoUtils.prototype._getJQueryWindow=function(){return this.FT.$(window);};VideoUtils.prototype._getJQueryDocument=function(){return this.FT.$(document);};VideoUtils.prototype.getParamValForJQueryElement=function($element,paramName){return $element.find('param[name="'+paramName+'"]').attr('value')||'';};VideoUtils.prototype.getAdURLObjFor=function(zone,position,videoKV){var adURLObj;try{adURLObj=this.FT.ads.buildURLForVideo(zone,position,videoKV);}catch(err){adURLObj={urlStem:'',additionalAdTargetingParams:''};}
return adURLObj;};VideoUtils.prototype.getIsAdblockPresent=function(){return(!this.FT.ads?true:false);};VideoUtils.prototype.getDfpZone=function(){return this.FT.env.dfp_zone;};VideoUtils.prototype.trackEvent=function(eventPath,optionalQueryParamsArray){var queryParamsArray=optionalQueryParamsArray||[];this.FT.analytics.siteIntelligence.sendAdditionalTracer(eventPath,queryParamsArray.join('&'));};VideoUtils.prototype.getElementPositionFromCenter=function(selector){var positionFromCenter=null,position=this.getElementPosition(selector),$document=this._getJQueryDocument(),docWidth;if(position&&$document){docWidth=$document.width();positionFromCenter={top:position.top,left:Math.round(position.left-(docWidth/2))};}
return positionFromCenter;};VideoUtils.prototype.getElementPosition=function(selector){var position=null,$element=this.getJQueryElement(selector),offset;if($element){offset=$element.offset();position={top:offset.top,left:offset.left};}
return position;};VideoUtils.prototype.getElementPercentageInView=function(selector){var percentageInView=null,elementDimensions=this.getElementDimensions(selector),elementPosition=this.getElementPosition(selector),$window=this._getJQueryWindow(),horizInViewFraction,vertInViewFraction,playerTop,playerBottom,playerLeft,playerRight,viewTop,viewBottom,viewLeft,viewRight;if(elementDimensions&&elementPosition&&$window){playerTop=elementPosition.top;playerBottom=playerTop+elementDimensions.height;playerLeft=elementPosition.left;playerRight=playerLeft+elementDimensions.width;viewTop=$window.scrollTop();viewBottom=viewTop+$window.height();viewLeft=$window.scrollLeft();viewRight=viewLeft+$window.width();vertInViewFraction=this._getDimensionFractionInView(viewTop,viewBottom,playerTop,playerBottom);horizInViewFraction=this._getDimensionFractionInView(viewLeft,viewRight,playerLeft,playerRight);percentageInView=Math.round(horizInViewFraction*vertInViewFraction*100);}
return percentageInView;};VideoUtils.prototype._getDimensionFractionInView=function(viewLesser,viewGreater,elementLesser,elementGreater){var elementSize=elementGreater-elementLesser,overlapSize=0,fractionInView;if(viewLesser<=elementLesser&&viewGreater<=elementLesser||viewLesser>=elementGreater&&viewGreater>=elementGreater){overlapSize=0;}else if(viewLesser<=elementLesser&&viewGreater>=elementGreater){overlapSize=elementSize;}else if(viewLesser>=elementLesser&&viewGreater<=elementGreater){overlapSize=viewGreater-viewLesser;}else if(viewLesser<=elementLesser&&viewGreater>elementLesser){overlapSize=viewGreater-elementLesser;}else if(viewLesser<elementGreater&&viewGreater>=elementGreater){overlapSize=elementGreater-viewLesser;}else{overlapSize=elementSize;}
fractionInView=(overlapSize/elementSize);return(isFinite(fractionInView)&&!isNaN(fractionInView)?fractionInView:0);};VideoUtils.prototype.getIsPageFocused=function(){var isPageFocused=null;if(typeof document.hasFocus!=='undefined'){isPageFocused=document.hasFocus();}else if(typeof document.visibilityState!=='undefined'){isPageFocused=document.visibilityState;}
return isPageFocused;};VideoUtils.prototype.getElementDimensions=function(selector){var dimensions=null,$element=this.getJQueryElement(selector),element=($element.length>0?$element[0]:null);if(element){dimensions={width:element.offsetWidth,height:element.offsetHeight};}
return dimensions;};VideoUtils.prototype.getTagValueForMedia=function(tagKey,media){var tagDescriptors=media.tags,tagStrings=[],index,tagDescriptorOrString;for(index=0;index<tagDescriptors.length;index+=1){tagDescriptorOrString=tagDescriptors[index];if(typeof tagDescriptorOrString.name!=='undefined'){tagStrings.push(tagDescriptorOrString.name);}else if(typeof tagDescriptorOrString==='string'){tagStrings.push(tagDescriptorOrString);}}
return this.getTagValueFromTagStrings(tagKey,tagStrings);};VideoUtils.prototype.getTagValueFromTagStrings=function(tagKey,tagStrings){var tagValue='',index,valueAfterTagKey;for(index=0;index<tagStrings.length;index+=1){valueAfterTagKey=this.getStringAfterPrefix(tagStrings[index],tagKey);if(valueAfterTagKey){tagValue=valueAfterTagKey;break;}}
return tagValue;};VideoUtils.prototype.getStringAfterPrefix=function(string,prefix){var stringAfterPrefix='';if(string.indexOf(prefix)===0){stringAfterPrefix=string.slice(prefix.length);}
return stringAfterPrefix;};VideoUtils.prototype.escapeWhitespace=function(string){var WHITESPACE_REGEX=/\W+/g;return string.replace(WHITESPACE_REGEX,'-');};VideoUtils.prototype.trim=function(string){return this.FT.$.trim(string);};VideoUtils.prototype.stripNonNumeric=function(inputString){var NON_NUMERIC_CHARS_REGEX=/\D/g,stringToStrip=(typeof inputString==='string'?inputString:'');return stringToStrip.replace(NON_NUMERIC_CHARS_REGEX,'');};VideoUtils.prototype.extend=function(extendee,extendor){var key;for(key in extendor){if(extendor.hasOwnProperty(key)){extendee[key]=extendor[key];}}};VideoUtils.prototype.bind=function(functionToBind,context){var argsArray=Array.prototype.slice.call(arguments,2),boundFunction=function(){return functionToBind.apply(context,argsArray.concat(Array.prototype.slice.call(arguments)));};return boundFunction;};VideoUtils.prototype.filter=function(obj,fn){var resultsArray=[];this.each(obj,function(property){if(fn(property)){resultsArray.push(property);}});return resultsArray;};VideoUtils.prototype.each=function(obj,fn){var key;for(key in obj){if(obj.hasOwnProperty(key)){fn(obj[key]);}}};VideoUtils.prototype.getElementCountForArray=function(arr){var elementCount=0;this.each(arr,function(){elementCount+=1;});return elementCount;};module.exports=new VideoUtils(globalFT);},{"./globalFT.js":9}]},{},[1]);